import numpy as np
import math

import matplotlib as mpl
import matplotlib.pyplot as plt
import matplotlib.gridspec as gridspec


t = np.zeros((52, 4, 4))

t[0]=[[   0.999993  ,0.00339337 ,-0.00132798   ,0.0463654],
[-0.00339145   , 0.999993  ,0.00144484  ,-0.0820206],
[ 0.00133288 ,-0.00144033    ,0.999998   ,-0.210582],
[          0   ,        0           ,0,           1]]

t[1]=[[    0.999998  , 0.00163735 , -0.00117884   , 0.0525073],
[  -0.0016368    , 0.999999 , 0.000468364  ,  -0.106545],
[   0.0011796 ,-0.000466434  ,   0.999999 ,   -0.235051],
[           0  ,          0   ,         0,            1]]

t[2]=[[    0.999996 ,   0.0016639 , -0.00228719   , 0.0497735],
[  -0.0016634  ,   0.999999  ,0.000219849  , -0.0975992],
[  0.00228755 ,-0.000216043   ,  0.999997  ,  -0.210337],
[           0  ,          0        ,    0  ,          1]]

t[3]=[[    0.999999 , 0.000581522  ,-0.00136061  ,  0.0498031],
[ -0.00058074   ,         1  ,0.000575077   , -0.102323],
[  0.00136095 ,-0.000574286   ,  0.999999   , -0.224871],
[           0  ,          0  ,          0    ,        1]]

t[4]=[[    0.999999 , 0.000727362 , -0.00120198   , 0.0364004],
[-0.000722462   ,  0.999991  , 0.00407206   ,-0.0223855],
[  0.00120494  ,-0.00407118   ,  0.999991   , -0.173914],
[           0   ,         0     ,       0    ,        1]]

t[5]=[[ 9.99870961e-01,  6.81162697e-03,  1.45486324e-02,  3.11726308e-02],
 [-6.78269284e-03,  9.99974922e-01, -2.03720430e-03, -7.55246629e-04],
 [-1.45621442e-02,  1.93826252e-03,  9.99892088e-01, -3.49958279e-01],
 [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  1.00000000e+00]]

t[6]=[[ 9.99887478e-01,  1.92548561e-03,  1.48769646e-02,  2.64636144e-02],
 [-1.91261555e-03,  9.99997784e-01, -8.79279121e-04,  2.22242061e-03],
 [-1.48786247e-02,  8.50726269e-04,  9.99888945e-01, -3.55279839e-01],
 [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  1.00000000e+00]]

t[7]=[[ 9.99977342e-01, -3.95212117e-03,  5.44942311e-03,  2.95913294e-02],
 [ 3.95291155e-03,  9.99992178e-01, -1.34276413e-04,  1.06933427e-03],
 [-5.44884981e-03,  1.55814458e-04,  9.99985143e-01, -3.12819795e-01],
 [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  1.00000000e+00]]


t[8]=[[    0.99999,  0.00432945, -0.00120711,   0.0291919],
[-0.00432425,    0.999982,  0.00427664,   0.0412161],
[  0.0012256, -0.00427137,     0.99999,   -0.142449],
[          0,           0,           0,           1]]
          
t[9]=[[    0.999999,   0.00158274, -1.36474e-06,    0.0312226],
[ -0.00158271,     0.999985,   0.00516159,     0.063733],
[ 9.53415e-06,  -0.00516158,    0.999987 ,   -0.151312],
[           0,            0,            0,            1]]
           
t[10]=[[   0.999993,  0.00343694, -0.00110322,    0.038263],
[-0.00343389,     0.99999,  0.00275682,   0.0442964],
[ 0.00111268, -0.00275301,    0.999996,   -0.159183],
[          0,           0,           0,           1]]
          
t[11]=[[   0.999999,  0.00152522, -1.3553e-05,   0.0300681],
[-0.00152513,    0.999986,  0.00499897,   0.0757528],
[2.11774e-05, -0.00499894,    0.999988,   -0.135936],
[          0,           0,           0,           1]]

t[12]=[[ 9.99629870e-01,  1.01012120e-02,  2.52604120e-02,  4.71246234e-02],
 [-1.00824243e-02,  9.99948792e-01, -8.71017303e-04, -2.16134426e-03],
 [-2.52679168e-02,  6.16008721e-04,  9.99680525e-01, -3.64661463e-01],
 [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  1.00000000e+00]]

t[13]=[[ 0.99931272 , 0.01269829,  0.03482575,  0.05733547],
 [-0.01262987 , 0.99991785, -0.00218394, -0.00761241],
 [-0.03485062 , 0.0017426,   0.99939101, -0.34401462],
 [ 0.         , 0.       ,   0.        ,  1.        ]]
t[14]=[[ 0.9992561,   0.00832654,  0.0376552,   0.09384566],
 [-0.00826923,  0.9999644,  -0.00167729, -0.00742908],
 [-0.03766782,  0.00136467,  0.99928938, -0.382822  ],
 [ 0.        ,  0.        ,  0.        ,  1.        ]]


t[15]=[
[ 0.999989,0.00402619,0.00225175, -0.165386],
[-0.00408086,0.999683, 0.0248263, 1.18486],
[-0.00215108,-0.0248352,0.999689,0.440172],
[0, 0, 0, 1]]

t[16]=[
[ 0.999964,0.00839569,0.00128942,-0.13248],
[-0.00842107,0.999741, 0.0211338, 1.03818],
[-0.00111166,-0.0211439,0.999776,0.334532],
[0, 0, 0, 1]]

t[17]=[
[0.999972, 0.00746309,0.000537638, -0.0382505],
[ -0.00746973, 0.999879,0.0136498, 0.477578],
[-0.000435703, -0.0136534, 0.999907,0.0304733],
[ 0,0,0,1]]

t[18]=[
[0.999974,0.0071274, -0.000901136,0.0174383],
[ -0.00712162, 0.999955, 0.00626042, 0.151062],
[ 0.000945716,-0.00625384,0.99998,-0.130245],
[ 0,0,0,1]]

t[19]=[
[0.999992, 0.00382565, -0.000643371,0.0331678],
[ -0.00382234,0.99998, 0.00506535,0.0837326],
[ 0.000662737,-0.00506285, 0.999987,-0.170206],
[ 0,0,0,1]]

t[20]=[
[0.999997, 0.00258969, -5.11242e-05,-0.00596107],
[ -0.00258908,0.99995, 0.00963564, 0.313682],
[ 7.60749e-05,-0.00963547, 0.999954, -0.0560084],
[ 0,0,0,1]]

t[21]=[
[0.999984, 0.00556974,0.000961881, -0.0444234],
[ -0.00558516, 0.999842,0.0168511, 0.564068],
[-0.000867873, -0.0168562, 0.999858,0.0699866],
[ 0,0,0,1]]

t[22]=[
[ 0.999973,0.00718784, 0.0014275,-0.0928371],
[-0.00721482,0.999776, 0.0198872,0.811186],
[-0.00128424,-0.0198969,0.999801,0.169795],
[0, 0, 0, 1]]

t[23]=[
[ 0.999982,0.00541402,0.00252606, -0.143845],
[-0.00547432,0.999685, 0.0245087,0.943717],
[-0.00239257,-0.0245221,0.999696,0.280013],
[0, 0, 0, 1]]

t[24]=[
[ 0.999976,0.00688102 ,0.000376072, -0.0910477],
[ -0.00688732,0.999762 ,0.0206915,0.78324],
[-0.000233604, -0.0206936,0.999786,0.282963],
[ 0,0,0,1]]

t[25]=[
[ 0.999976,0.00689903 ,0.000219742, -0.0455939],
[ -0.00690147,0.999874 ,0.0142818,0.538843],
[-0.000121184, -0.0142829,0.999898 ,0.0168237],
[ 0,0,0,1]]

t[26]=[
[ 0.99997 ,0.00761372, -0.00103279,0.0169278],
[-0.00760616 ,0.999946 ,0.00714074 ,0.111324],
[ 0.0010871, -0.00713267,0.999974, -0.148088],
[0, 0, 0, 1]]

t[27]=[
[0.999978 ,0.00638159, -0.00191741,0.0490156],
[ -0.0063769 ,0.999977 ,0.00244071, -0.093745],
[0.00193294, -0.00242843 ,0.999995, -0.215141],
[0, 0, 0, 1]]

t[28]=[
[0.999994,0.0034138, -0.00074508,0.042356],
[-0.00341042,0.999984 ,0.00448126,-0.0219932],
[0.000760366, -0.00447869,0.99999,-0.21085],
[0, 0, 0, 1]]

t[29]=[
[ 0.999998,0.00214017 ,0.000457323 ,0.0121093],
[ -0.00214498,0.999939 ,0.0107988 ,0.21045],
[-0.000434184, -0.0107998,0.999942, -0.14198],
[ 0,0,0,1]]

t[30]=[
[0.999995 ,0.00191197 ,0.00258264,-0.0428804],
[-0.00195369 ,0.999866,0.0162467 ,0.475949],
[-0.00255123,-0.0162517 ,0.999865,-0.0283634],
[0, 0, 0, 1]]

t[31]=[
[0.999993 ,0.00199577 ,0.00314551,-0.0923999],
[-0.00207965 ,0.999636,0.0268923,0.66198],
[-0.00309069,-0.0268986 ,0.999633 ,0.143859],
[0, 0, 0, 1]]

t[32]=[[   0.999983  ,0.00201132 , 0.00546864  , -0.151842],
[-0.00217978  ,  0.999518,   0.0309745,    0.699581],
[-0.00540371 , -0.0309859   , 0.999505  ,  0.236112],
[          0          , 0      ,     0   ,        1]]

t[33]=[[   0.999979,  0.00424874,  0.00491033,   -0.235513],
[-0.00442954,     0.99929,   0.0374157,    0.826108],
[-0.00474788,  -0.0374367,    0.999288,    0.531212],
[          0,           0,           0,           1]]
          
t[34]=[[   0.999976,  0.00450583,  0.00529186,   -0.304162],
[-0.00471556,    0.999176,   0.0403126,    0.952798],
[-0.00510586,  -0.0403365,    0.999173,    0.778594],
[          0,           0,           0,           1]]

t[35]=[[   0.999965,  0.00692855,  0.00467494,    -0.37761],
[-0.00713552,    0.998924,   0.0458146,       1.022],
[-0.00435248,  -0.0458463,    0.998939,     1.06155],
[          0,           0,           0,           1]]
          
t[36]=[[   0.999895,   0.0140986,  0.00322562,   -0.426722],
[ -0.0142328,    0.998828,   0.0462641,     1.22162],
[-0.00256958,  -0.0463052,    0.998924,     1.24884],
[          0,           0,           0,           1]]
          
t[37]=[[   0.999885,  -0.0149035,  0.00264518,   -0.576192],
[  0.0147538,    0.998657,   0.0496605,     1.75258],
[-0.00338175,  -0.0496158,    0.998763,     1.70471],
[          0,           0,           0,           1]]

t[38]=[[ 0.99749972,  0.00217169,  0.07063698,  0.1587193 ],
 [-0.0015669,   0.99996165, -0.00861625, -0.01947389],
 [-0.07065298,  0.00848403,  0.99746488, -0.41477703],
 [ 0.        ,  0.,          0.        ,  1.        ]]

t[39]=[[ 0.99786365,  0.00284746,  0.06526888,  0.1501976 ],
 [-0.00201038,  0.99991494, -0.01288716, -0.03575224],
 [-0.06530002,  0.01272841,  0.99778449, -0.41597642],
 [ 0.        ,  0.        ,  0.        ,  1.        ]]


t[40]=[[   0.999849,   0.0173074,  0.00175033,   -0.407036],
[ -0.0173533,    0.999371,   0.0309136,     1.76022],
[-0.00121419,  -0.0309393,    0.999521,    0.854127],
[          0,           0,           0,           1]]

t[41]=[[   0.999976,  0.00683091,  0.00150796,   -0.343948],
[-0.00687389,    0.999507,   0.0306253,     1.57785],
[-0.00129802,  -0.0306349,     0.99953,    0.643275],
[          0,           0,           0,           1]]
          
t[42]=[[    0.999606    ,0.0280455,    0.0012671 ,   -0.278799],
[  -0.0280684,     0.999297,    0.0248563,      1.31723],
[-0.000569098,   -0.0248821,      0.99969,     0.567789],
[           0,            0,            0 ,           1]]
        
t[43]=[[   0.999829,   0.0181745, -0.00337767,   -0.112325],
[ -0.0181158 ,   0.999697,    0.016661,     1.15738],
[ 0.00367945 ,  -0.016597,    0.999855,    0.368243],
[          0 ,          0,           0,           1]]
          
t[44]=[[   0.999869,   0.0157854, -0.00361022,  -0.0736657],
[ -0.0157309,    0.999769,     0.01465,     0.54468],
[ 0.00384064,  -0.0145913,    0.999886,   0.0920503],
[          0,           0,           0,           1]]
          
t[45]=[[   0.999912,   0.0127798, -0.00365386,   0.0373545],
[ -0.0127661,    0.999911,  0.00376507,   0.0491226],
[ 0.00370165,  -0.0037181,    0.999986,    -0.17799],
[          0,           0,           0,           1]]
          
t[46]=[[   0.999929,   0.0106385, -0.00530164,    0.080958],
[ -0.0106749,    0.999919, -0.00689441,   -0.203862],
[ 0.00522786,  0.00695052,    0.999962,   -0.246293],
[          0,           0,           0,           1]]
          
t[47]=[[   0.999956,  0.00650363, -0.00672957,    0.110656],
[-0.00661111,    0.999849,  -0.0160743,   -0.379941],
[ 0.00662401,   0.0161181,    0.999848,   -0.254495],
[          0,           0,           0,           1]]
          
t[48]=[[   0.999956,  0.00413237, -0.00847975,    0.110795],
[-0.00433174,    0.999711,   -0.023629,   -0.526409],
[ 0.00837966,   0.0236646,    0.999685,   -0.251666],
[          0,           0,           0,           1]]

 
t[49]=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]
t[50]=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]      

t[51]=[[   0.999945, -0.00534424, -0.00903067,    0.124086],
[ 0.00503846,    0.999424,  -0.0335498,   -0.604236],
[ 0.00920477,   0.0335025,    0.999396,   -0.327268],
[          0,           0,           0,           1]]

def visualize_trajectory(trajectory):
    # Unpack X Y Z each trajectory point
    locX = []
    locY = []
    locZ = []

    for i in range(0, trajectory.shape[1]):
        current_pos = trajectory[:, i]
        
        locX.append(current_pos.item(0))
        locY.append(current_pos.item(1))
        locZ.append(current_pos.item(2))

    plt.style.use("seaborn-whitegrid")

    # Get figure
    # fig = plt.figure(figsize=(8, 6), dpi=100)
    gspec = gridspec.GridSpec(3, 3)
    ZY_plt = plt.subplot(gspec[0, 1:])
    YX_plt = plt.subplot(gspec[1:, 0])
    traj_main_plt = plt.subplot(gspec[1:, 1:])
    D3_plt = plt.subplot(gspec[0, 0], projection='3d')

    # Actual trajectory plotting ZX
    toffset = 1.06
    traj_main_plt.plot(locZ, locX, ".-", label="Trajectory", zorder=1, linewidth=1, markersize=4)
    traj_main_plt.set_xlabel("Z")
    traj_main_plt.set_ylabel("X")

    # Plot camera initial location
    traj_main_plt.scatter([0], [0], s=8, c="red", label="Start location", zorder=2)
    traj_main_plt.legend(loc=1, title="Legend", borderaxespad=0., fontsize="medium", frameon=True)

    # Plot ZY
    ZY_plt.set_xlabel("Z")
    ZY_plt.set_ylabel("Y", labelpad=-4)
    ZY_plt.axes.xaxis.set_ticklabels([])
    ZY_plt.plot(locZ, locY, ".-", linewidth=1, markersize=4, zorder=0)
    ZY_plt.scatter([0], [0], s=8, c="red", label="Start location", zorder=2)


    # Plot YX
    YX_plt.set_ylabel("X")
    YX_plt.set_xlabel("Y")
    YX_plt.plot(locY, locX, ".-", linewidth=1, markersize=4, zorder=0)
    YX_plt.scatter([0], [0], s=8, c="red", label="Start location", zorder=2)


    # Plot 3D
    D3_plt.set_title("3D trajectory", y=toffset)
    D3_plt.plot3D(locX, locZ, locY, zorder=0)
    D3_plt.scatter(0, 0, 0, s=8, c="red", zorder=1)
    D3_plt.tick_params(direction='out', pad=-2)
    D3_plt.set_xlabel("X", labelpad=0)
    D3_plt.set_ylabel("Z", labelpad=0)
    D3_plt.set_zlabel("Y", labelpad=-2)
    
    # plt.axis('equal')
    D3_plt.view_init(45, azim=30)
    plt.tight_layout()
    plt.show()

# Initialize trajectory and the initial pose
trajectory = np.zeros((3, 52))
pose = np.eye(4)

for i in range(51):

    curr_p = t[i]
    next_pose = pose @ np.linalg.inv(curr_p)
    pose = next_pose

    position = next_pose @ np.array([0., 0., 0., 1.])

    trajectory[:, i + 1] = position[0:3]

visualize_trajectory(trajectory)
